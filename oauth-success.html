<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        /* Minimal invisible page - user won't see this */
        body {
            margin: 0;
            padding: 0;
            background: #f8fafc;
        }
    </style>
</head>

<body>
    <script>
        // Immediate execution - no delays
        (function () {
            try {
                // Get URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                const token = urlParams.get('token');
                const name = urlParams.get('name');
                const email = urlParams.get('email');
                const role = urlParams.get('role');

                if (token && name && email) {
                // Debug logging
                console.log('OAuth Success - Token:', token ? 'present' : 'missing');
                console.log('OAuth Success - Name:', name);
                console.log('OAuth Success - Email:', email);
                console.log('OAuth Success - Role:', role);
                console.log('OAuth Success - Role type:', typeof role);
                
                // Store in localStorage
                localStorage.setItem('token', token);
                localStorage.setItem('user', JSON.stringify({
                    name: decodeURIComponent(name),
                    email: decodeURIComponent(email),
                    role: role || 'candidate'
                }));

                // Determine dashboard URL
                const dashboardFile = role === 'recruiter' ? 'recruiter-dashboard.html' : 'candidate-dashboard.html';
                console.log('OAuth Success - Redirecting to:', dashboardFile);

                // IMMEDIATE redirect using replace (doesn't add to history)
                window.location.replace(`/${dashboardFile}`);
            } else {
                console.error('OAuth Success - Missing parameters:', { token: !!token, name, email, role });
                // Error case - redirect to sign-in
                window.location.replace('/smart_resume_signin_page.html');
            }
            } catch (error) {
                // Fallback on any error
                console.error('OAuth redirect error:', error);
                window.location.replace('/smart_resume_signin_page.html');
            }
        })();
    </script>
</body>

</html>